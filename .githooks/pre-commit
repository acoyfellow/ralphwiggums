#!/bin/bash
# YAML Validation Pre-commit Hook
# Install: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

echo "üîç Validating YAML files..."

# Find all YAML files in .github/workflows/
YAML_FILES=$(find .github/workflows -name "*.yml" -o -name "*.yaml" 2>/dev/null)

if [ -n "$YAML_FILES" ]; then
    # Try Node.js YAML validation first (more reliable)
    if command -v node &> /dev/null && node -e "require('yaml')" &> /dev/null; then
        echo "Using Node.js YAML validation..."
        if ! npm run --silent validate-yaml 2>/dev/null; then
            echo "‚ùå YAML validation failed"
            echo "Fix the YAML syntax before committing!"
            exit 1
        fi
    # Fallback to Python validation
    elif command -v python3 &> /dev/null && python3 -c "import yaml" &> /dev/null; then
        for file in $YAML_FILES; do
            echo "Checking $file..."
            if ! python3 -c "import yaml; yaml.safe_load(open('$file'))" 2>/dev/null; then
                echo "‚ùå YAML validation failed for $file"
                echo "Fix the YAML syntax before committing!"
                exit 1
            fi
        done
    else
        echo "‚ö†Ô∏è  Node.js/YAML or Python3/PyYAML not available - skipping YAML validation"
    fi
    echo "‚úÖ All YAML files valid"
else
    echo "‚ÑπÔ∏è  No YAML files found to validate"
fi

echo "üéØ Pre-commit checks passed!"
exit 0